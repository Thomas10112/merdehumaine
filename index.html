<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rank Manager (V1 local)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        kbd { padding: .12rem .35rem; border-radius: .35rem; background:#111; color:#fff; font-size:.82rem; }
    </style>
</head>

<body class="bg-light">
<div class="container py-5" style="max-width: 760px;">

    <div class="d-flex align-items-end justify-content-between mb-4">
        <div>
            <h1 class="h4 mb-1">Rank Manager</h1>
            <div class="text-muted small">
                Raccourcis : <kbd>‚Üë</kbd> promouvoir ¬∑ <kbd>‚Üì</kbd> r√©trograder ¬∑ <kbd>Home</kbd> min ¬∑ <kbd>End</kbd> max
            </div>
        </div>
        <span class="badge text-bg-secondary">Local</span>
    </div>

    <!-- LOCK BAR -->
    <div class="alert alert-warning d-flex flex-wrap align-items-center gap-2 mb-3">
        <strong>√âdition :</strong>
        <span id="lockState" class="badge text-bg-dark">Verrouill√©</span>

        <div class="ms-auto d-flex flex-wrap gap-2 align-items-center">
            <input id="passInput" type="password" class="form-control form-control-sm" placeholder="mot de passe" style="width:220px;">
            <button id="btnUnlock" class="btn btn-sm btn-primary">D√©verrouiller</button>
            <button id="btnLock" class="btn btn-sm btn-outline-dark">Verrouiller</button>
        </div>

        <div class="w-100 small text-muted mt-2">
            Verrou UI (pas une s√©curit√© forte). Sauvegarde locale (navigateur) uniquement.
        </div>
    </div>

    <!-- MAIN -->
    <div class="card shadow-sm">
        <div class="card-body">

            <div class="d-flex align-items-center gap-3 mb-3">
                <div id="rankIcon"
                     class="rounded-circle border bg-white d-flex align-items-center justify-content-center"
                     style="width:58px;height:58px;font-size:28px;">üè∑Ô∏è</div>

                <div class="flex-grow-1">
                    <div class="text-muted small">Rank actuel</div>
                    <span id="rankBadge" class="badge rounded-pill fs-5 px-4 py-2"></span>
                </div>
            </div>

            <div class="d-flex gap-2 mb-3">
                <button id="btnDown" class="btn btn-outline-danger w-50">‚¨á R√©trograder</button>
                <button id="btnUp" class="btn btn-outline-success w-50">‚¨Ü Promouvoir</button>
            </div>

            <div class="mb-3">
                <label class="form-label">Choisir un rank</label>
                <select id="rankSelect" class="form-select"></select>
            </div>

            <div class="d-flex flex-wrap gap-2 mb-3">
                <button id="btnMin" class="btn btn-outline-dark">Min</button>
                <button id="btnMax" class="btn btn-outline-dark">Max</button>
                <button id="btnReset" class="btn btn-outline-dark ms-auto">Reset</button>
            </div>

            <hr class="my-3">

            <!-- BADGE EDITOR -->
            <h2 class="h6 mb-2">Badges par r√¥le</h2>
            <div class="text-muted small mb-2">D√©finis un emoji pour chaque rank.</div>

            <div class="row g-2 align-items-end">
                <div class="col-12 col-md-6">
                    <label class="form-label">R√¥le √† modifier</label>
                    <select id="badgeRankSelect" class="form-select"></select>
                </div>

                <div class="col-8 col-md-4">
                    <label class="form-label">Badge (emoji)</label>
                    <input id="badgeInput" class="form-control" maxlength="12" placeholder="ex: üí©">
                </div>

                <div class="col-4 col-md-2 d-grid">
                    <button id="btnSaveBadge" class="btn btn-primary">Sauver</button>
                </div>
            </div>

            <div class="d-flex flex-wrap gap-2 mt-2">
                <button id="btnDefaultBadge" class="btn btn-outline-secondary btn-sm">Remettre par d√©faut</button>
                <span class="text-muted small align-self-center">Le badge en haut suit le rank actuel.</span>
            </div>

        </div>
    </div>

</div>

<script>
    /* =========================
       CONFIG
    ========================= */
    const EDIT_PASSWORD = "sombremerde";
    const STORAGE_KEY = "rank_manager_local_v1";

    /* =========================
       DATA
    ========================= */
    const RANKS = [
        { id:"enorme", label:"Enorme merde",       cls:"text-bg-danger",  defaultIcon:"üí©" },
        { id:"grosse", label:"Grosse merde",       cls:"text-bg-danger",  defaultIcon:"ü™£" },
        { id:"mediane",label:"Merde m√©diane",      cls:"text-bg-warning", defaultIcon:"üßª" },
        { id:"petite", label:"Petite merde",       cls:"text-bg-warning", defaultIcon:"üò¨" },
        { id:"merde",  label:"Merde",              cls:"text-bg-warning", defaultIcon:"ü´†" },
        { id:"bad",    label:"Mauvais matelot",    cls:"text-bg-info",    defaultIcon:"‚öì" },
        { id:"mid",    label:"Matelot moyen",      cls:"text-bg-info",    defaultIcon:"üö¢" },
        { id:"ok",     label:"Matelot acceptable", cls:"text-bg-info",    defaultIcon:"üß≠" },
        { id:"good",   label:"Bon matelot",        cls:"text-bg-success", defaultIcon:"üèÖ" },
        { id:"boss",   label:"Quartier-ma√Ætre",    cls:"text-bg-success", defaultIcon:"üéñÔ∏è" }
    ];

    const byId = (id) => RANKS.find(r => r.id === id) || RANKS[0];
    const idxOf = (id) => Math.max(0, RANKS.findIndex(r => r.id === id));
    const clamp = (i) => Math.max(0, Math.min(RANKS.length - 1, i));

    function normalizePass(s) {
        return (s ?? "").toString().trim().toLowerCase().replace(/\s+/g, "");
    }

    /* =========================
       STATE
    ========================= */
    const DEFAULT_STATE = {
        locked: true,
        rankId: RANKS[0].id,
        iconsById: {}
    };

    let state = structuredClone(DEFAULT_STATE);

    /* =========================
       LOAD / SAVE
    ========================= */
    function safeParse(json) {
        try { return JSON.parse(json); } catch { return null; }
    }
    function load() {
        const raw = localStorage.getItem(STORAGE_KEY);
        const parsed = raw ? safeParse(raw) : null;
        if (!parsed || typeof parsed !== "object") return;

        state = { ...structuredClone(DEFAULT_STATE), ...parsed };
        state.locked = !!state.locked;
        state.rankId = byId(state.rankId).id;
        state.iconsById = (state.iconsById && typeof state.iconsById === "object") ? state.iconsById : {};
    }
    function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    /* =========================
       DOM
    ========================= */
    const elLockState = document.getElementById("lockState");
    const elPassInput = document.getElementById("passInput");
    const btnUnlock = document.getElementById("btnUnlock");
    const btnLock = document.getElementById("btnLock");

    const elRankIcon = document.getElementById("rankIcon");
    const elRankBadge = document.getElementById("rankBadge");
    const elSelect = document.getElementById("rankSelect");

    const btnUp = document.getElementById("btnUp");
    const btnDown = document.getElementById("btnDown");
    const btnMin = document.getElementById("btnMin");
    const btnMax = document.getElementById("btnMax");
    const btnReset = document.getElementById("btnReset");

    const badgeRankSelect = document.getElementById("badgeRankSelect");
    const badgeInput = document.getElementById("badgeInput");
    const btnSaveBadge = document.getElementById("btnSaveBadge");
    const btnDefaultBadge = document.getElementById("btnDefaultBadge");

    /* =========================
       UI
    ========================= */
    function iconFor(rank) {
        return state.iconsById[rank.id] || rank.defaultIcon || "üè∑Ô∏è";
    }
    function buildSelects() {
        elSelect.innerHTML = "";
        badgeRankSelect.innerHTML = "";

        for (const r of RANKS) {
            const o1 = document.createElement("option");
            o1.value = r.id;
            o1.textContent = r.label;
            elSelect.appendChild(o1);

            const o2 = document.createElement("option");
            o2.value = r.id;
            o2.textContent = r.label;
            badgeRankSelect.appendChild(o2);
        }
    }
    function applyLockUI() {
        elLockState.textContent = state.locked ? "Verrouill√©" : "D√©verrouill√©";
        elLockState.className = "badge " + (state.locked ? "text-bg-dark" : "text-bg-success");

        const controls = [
            btnUp, btnDown, btnMin, btnMax, btnReset, elSelect,
            badgeRankSelect, badgeInput, btnSaveBadge, btnDefaultBadge
        ];
        controls.forEach(c => c.disabled = state.locked);
    }
    function render() {
        const r = byId(state.rankId);
        elRankBadge.textContent = r.label;
        elRankBadge.className = `badge rounded-pill fs-5 px-4 py-2 ${r.cls}`;
        elRankIcon.textContent = iconFor(r);

        elSelect.value = r.id;

        badgeRankSelect.value = r.id;
        badgeInput.value = iconFor(r);

        btnDown.disabled = state.locked || (idxOf(r.id) === 0);
        btnUp.disabled = state.locked || (idxOf(r.id) === RANKS.length - 1);

        applyLockUI();
    }

    /* =========================
       LOGIC
    ========================= */
    function setRankByIndex(i) {
        if (state.locked) return;
        state.rankId = RANKS[clamp(i)].id;
        save();
        render();
    }
    function promote() { setRankByIndex(idxOf(state.rankId) + 1); }
    function demote()  { setRankByIndex(idxOf(state.rankId) - 1); }

    /* =========================
       EVENTS
    ========================= */
    btnUnlock.addEventListener("click", () => {
        const ok = normalizePass(elPassInput.value) === normalizePass(EDIT_PASSWORD);
        if (ok) {
            state.locked = false;
            elPassInput.value = "";
            save();
            render();
        } else {
            elPassInput.select();
        }
    });

    btnLock.addEventListener("click", () => {
        state.locked = true;
        save();
        render();
    });

    btnUp.addEventListener("click", promote);
    btnDown.addEventListener("click", demote);
    btnMin.addEventListener("click", () => setRankByIndex(0));
    btnMax.addEventListener("click", () => setRankByIndex(RANKS.length - 1));

    elSelect.addEventListener("change", (e) => {
        if (state.locked) return;
        state.rankId = byId(e.target.value).id;
        save();
        render();
    });

    btnReset.addEventListener("click", () => {
        localStorage.removeItem(STORAGE_KEY);
        state = structuredClone(DEFAULT_STATE);
        save();
        buildSelects();
        render();
    });

    // Badge editor
    badgeRankSelect.addEventListener("change", (e) => {
        const r = byId(e.target.value);
        badgeInput.value = iconFor(r);
    });

    btnSaveBadge.addEventListener("click", () => {
        if (state.locked) return;
        const r = byId(badgeRankSelect.value);
        const v = (badgeInput.value || "").trim();
        if (!v) return;
        state.iconsById[r.id] = v;
        save();
        render();
    });

    btnDefaultBadge.addEventListener("click", () => {
        if (state.locked) return;
        const r = byId(badgeRankSelect.value);
        delete state.iconsById[r.id];
        save();
        render();
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", (e) => {
        const tag = (document.activeElement?.tagName || "").toLowerCase();
        const typing = tag === "input" || tag === "textarea" || tag === "select";
        if (typing) return;
        if (state.locked) return;

        if (e.key === "ArrowUp") { e.preventDefault(); promote(); }
        if (e.key === "ArrowDown") { e.preventDefault(); demote(); }
        if (e.key === "Home") { e.preventDefault(); setRankByIndex(0); }
        if (e.key === "End") { e.preventDefault(); setRankByIndex(RANKS.length - 1); }
    });

    /* =========================
       INIT
    ========================= */
    load();
    buildSelects();
    render();
</script>
</body>
</html>
